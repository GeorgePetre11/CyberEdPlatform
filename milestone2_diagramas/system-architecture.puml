@startuml Cybersecurity Learning Platform - System Architecture

skinparam classAttributeIconSize 0
skinparam backgroundColor #FFFFFF
skinparam shadowing false
skinparam packageStyle rectangle
skinparam linetype ortho
skinparam nodesep 300
skinparam ranksep 250
skinparam ArrowColor #000000
skinparam ArrowThickness 1
skinparam ArrowLollipopColor #000000

title Cybersecurity Learning Platform - Complete System Architecture\nwith Design Patterns

' ============================================
' ENUMS
' ============================================
package "Enumerations" <<Rectangle>> {
  enum Role {
    ROLE_USER
    ROLE_ADMIN
  }
}

' ============================================
' MODEL / DOMAIN LAYER
' ============================================
package "Domain Models" <<Rectangle>> {
  
  class User {
    - id: Long
    - username: String
    - password: String
    - roles: Set<Role>
    --
    + User()
    + User(username: String, password: String, roles: Set<Role>)
    + getId(): Long
    + setId(id: Long): void
    + getUsername(): String
    + setUsername(username: String): void
    + getPassword(): String
    + setPassword(password: String): void
    + getRoles(): Set<Role>
    + setRoles(roles: Set<Role>): void
    + addRole(role: Role): void
  }
  
  class Course {
    - id: Long
    - title: String
    - description: String
    - price: double
    - quantity: int
    - createdAt: Instant
    --
    + Course()
    + Course(title: String, description: String, price: double, quantity: int)
    + getId(): Long
    + setId(id: Long): void
    + getTitle(): String
    + setTitle(title: String): void
    + getDescription(): String
    + setDescription(description: String): void
    + getPrice(): double
    + setPrice(price: double): void
    + getQuantity(): int
    + setQuantity(quantity: int): void
    + getCreatedAt(): Instant
    --
    **@CreationTimestamp**
    Auto-populates createdAt
  }
  
  class Purchase {
    - id: Long
    - user: User
    - course: Course
    - purchasedAt: Instant
    --
    + Purchase()
    + Purchase(user: User, course: Course)
    + getId(): Long
    + setId(id: Long): void
    + getUser(): User
    + setUser(user: User): void
    + getCourse(): Course
    + setCourse(course: Course): void
    + getPurchasedAt(): Instant
    --
    **@CreationTimestamp**
    Auto-populates purchasedAt
  }
  
  class Challenge {
    --
    Future implementation
  }
  
  class ForumPost {
    --
    Future implementation
  }
  
  class ForumComment {
    --
    Future implementation
  }
  
  class Question {
    --
    Future implementation
  }
}

' ============================================
' REPOSITORY LAYER
' ============================================
package "Data Access Layer" <<Database>> {
  
  interface JpaRepository<T,ID> {
    + findAll(): List<T>
    + findById(id: ID): Optional<T>
    + save(entity: T): T
    + deleteById(id: ID): void
    + count(): long
  }
  
  interface UserRepository {
    + findByUsername(username: String): Optional<User>
    + existsByUsername(username: String): boolean
  }
  
  interface CourseRepository {
    + existsByTitle(title: String): boolean
  }
  
  interface PurchaseRepository {
    + findByUser(user: User): List<Purchase>
  }
  
  interface ChallengeRepository {
    --
    Future implementation
  }
  
  interface ForumPostRepository {
    --
    Future implementation
  }
  
  interface ForumCommentRepository {
    --
    Future implementation
  }
}

' ============================================
' SERVICE LAYER - FACADE PATTERN
' ============================================
package "Business Logic Layer" <<Rectangle>> {
  
  class CartService {
    - courseRepo: CourseRepository
    - items: Map<Long, Integer>
    --
    + getItems(): Map<Course, Integer>
    + add(courseId: Long): void
    + remove(courseId: Long): void
    + clear(): void
    + isEmpty(): boolean
    + getTotalItems(): int
    + getTotalPrice(): double
    --
    **FACADE PATTERN**
    Simplifies cart operations
    Hides repository complexity
    **@SessionScope**
  }
  
  class CustomUserDetailsService {
    - userRepository: UserRepository
    --
    + loadUserByUsername(username: String): UserDetails
    --
    **TEMPLATE METHOD PATTERN**
    Implements UserDetailsService
    Customizes user loading step
    Framework handles authentication
  }
  
  interface UserDetailsService <<interface>> {
    + loadUserByUsername(username: String): UserDetails
    --
    **Spring Security Template**
    Defines authentication algorithm
  }
}

' ============================================
' CONFIG / SECURITY LAYER - STRATEGY & FACTORY
' ============================================
package "Configuration Layer" <<Rectangle>> {
  
  class SecurityConfig {
    --
    + filterChain(http: HttpSecurity): SecurityFilterChain
    + passwordEncoder(): PasswordEncoder
    --
    **STRATEGY PATTERN**
    PasswordEncoder is strategy interface
    BCrypt is concrete strategy
    Can switch to Argon2, SCrypt, etc.
  }
  
  interface PasswordEncoder <<interface>> {
    + encode(rawPassword: CharSequence): String
    + matches(rawPassword: CharSequence, encodedPassword: String): boolean
    --
    **Strategy Interface**
  }
  
  class BCryptPasswordEncoder {
    --
    + encode(rawPassword: CharSequence): String
    + matches(rawPassword: CharSequence, encodedPassword: String): boolean
    --
    **Concrete Strategy**
  }
  
  class Argon2PasswordEncoder {
    --
    + encode(rawPassword: CharSequence): String
    + matches(rawPassword: CharSequence, encodedPassword: String): boolean
    --
    **Alternative Strategy**
  }
  
  class SCryptPasswordEncoder {
    --
    + encode(rawPassword: CharSequence): String
    + matches(rawPassword: CharSequence, encodedPassword: String): boolean
    --
    **Alternative Strategy**
  }
  
  class CartAdvice {
    - cartService: CartService
    --
    + cartService(): CartService
    --
    **@ControllerAdvice**
    Makes cart available to all views
  }
  
  class CyberEdPlatformApplication {
    --
    + main(args: String[]): void
    + createAdmin(userRepo: UserRepository, encoder: PasswordEncoder): CommandLineRunner
    + seedCourses(courseRepo: CourseRepository): CommandLineRunner
    + createDemoUser(userRepo: UserRepository, encoder: PasswordEncoder): CommandLineRunner
    --
    **FACTORY METHOD PATTERN**
    Creates initial admin user
    Creates initial courses
    Creates demo user
    Encapsulates object creation logic
  }
}

' ============================================
' CONTROLLER LAYER - SINGLETONS
' ============================================
package "Presentation Layer" <<Rectangle>> {
  
  class HomeController {
    --
    + home(): String
    + login(): String
    --
    **@Controller**
    Spring Singleton Bean
  }
  
  class AuthController {
    - userRepository: UserRepository
    - passwordEncoder: PasswordEncoder
    --
    + showRegisterForm(): String
    + register(username: String, password: String, model: Model): String
    --
    **@Controller**
    Spring Singleton Bean
  }
  
  class CourseController {
    - courseRepository: CourseRepository
    --
    + listCourses(model: Model): String
    --
    **@Controller**
    Spring Singleton Bean
  }
  
  class CartController {
    - cartService: CartService
    - purchaseRepository: PurchaseRepository
    - userRepository: UserRepository
    - courseRepository: CourseRepository
    --
    + viewCart(model: Model): String
    + addToCart(id: Long): String
    + removeFromCart(id: Long): String
    + checkout(userDetails: UserDetails): String
    --
    **@Controller**
    Spring Singleton Bean
  }
  
  class ChallengeController {
    --
    Future implementation
  }
  
  class ForumController {
    --
    Future implementation
  }
  
  class ProfileController {
    --
    Future implementation
  }
  
  class AdminUserController {
    --
    Future implementation
  }
  
  class AdminController {
    - courseRepository: CourseRepository
    --
    + listCourses(model: Model): String
    + createCourse(course: Course): String
    + deleteCourse(id: Long): String
    --
    **@Controller**
    Spring Singleton Bean
  }
}

' ============================================
' RELATIONSHIPS - Domain Models
' ============================================
User "1" *-- "many" Role : has >
User "1" -- "many" Purchase : makes >
User "1" -- "many" ForumPost : authors >
User "1" -- "many" ForumComment : writes >

Course "1" -- "many" Purchase : purchased in >

ForumPost "1" *-- "many" ForumComment : contains >
ForumPost "many" -- "1" User : authored by >
ForumComment "many" -- "1" User : written by >
ForumComment "many" -- "1" ForumPost : belongs to >

Challenge "1" -- "many" Question : contains >

' ============================================
' RELATIONSHIPS - Repository Inheritance
' ============================================
UserRepository --|> JpaRepository
CourseRepository --|> JpaRepository
PurchaseRepository --|> JpaRepository
ChallengeRepository --|> JpaRepository
ForumPostRepository --|> JpaRepository
ForumCommentRepository --|> JpaRepository

' ============================================
' RELATIONSHIPS - Services & Dependencies
' ============================================
CartService --> CourseRepository : uses >
CartService ..> Course : transforms to >

CustomUserDetailsService ..|> UserDetailsService : implements
CustomUserDetailsService --> UserRepository : queries >
CustomUserDetailsService ..> User : loads >

' ============================================
' RELATIONSHIPS - Configuration
' ============================================
SecurityConfig ..> PasswordEncoder : creates
SecurityConfig ..> BCryptPasswordEncoder : instantiates

PasswordEncoder <|.. BCryptPasswordEncoder : implements
PasswordEncoder <|.. Argon2PasswordEncoder : implements
PasswordEncoder <|.. SCryptPasswordEncoder : implements

CartAdvice --> CartService : injects >

CyberEdPlatformApplication ..> User : creates admin/user
CyberEdPlatformApplication ..> Course : seeds
CyberEdPlatformApplication --> UserRepository : uses
CyberEdPlatformApplication --> CourseRepository : uses
CyberEdPlatformApplication --> PasswordEncoder : uses

' ============================================
' RELATIONSHIPS - Controllers
' ============================================
HomeController ..> "views" : renders

AuthController --> UserRepository : saves to
AuthController --> PasswordEncoder : encodes with
AuthController ..> User : creates

CourseController --> CourseRepository : queries
CourseController ..> Course : displays

CartController --> CartService : manages
CartController --> PurchaseRepository : saves to
CartController --> UserRepository : queries
CartController --> CourseRepository : updates
CartController ..> Purchase : creates

ChallengeController --> ChallengeRepository : queries
ChallengeController ..> Challenge : displays
ChallengeController ..> Question : generates

ForumController --> ForumPostRepository : manages
ForumController --> ForumCommentRepository : manages
ForumController --> UserRepository : queries
ForumController ..> ForumPost : creates
ForumController ..> ForumComment : creates

ProfileController --> UserRepository : queries
ProfileController --> PurchaseRepository : queries
ProfileController ..> User : displays
ProfileController ..> Purchase : shows history

AdminUserController --> UserRepository : manages
AdminUserController ..> User : updates

AdminController --> CourseRepository : manages
AdminController ..> Course : CRUD operations

' ============================================
' NOTES - Design Patterns Explanation
' ============================================
note right of CartService
  **FACADE PATTERN**
  ━━━━━━━━━━━━━━━━━━
  Provides simplified interface
  for complex cart operations:
  
  • Hides Map manipulation
  • Manages course lookups
  • Calculates totals
  • Session-scoped (one per user)
  
  Without Facade, controllers
  would need to handle repository
  calls and transformations directly.
end note

note right of PasswordEncoder
  **STRATEGY PATTERN**
  ━━━━━━━━━━━━━━━━━━━
  PasswordEncoder is the strategy
  interface. Different algorithms
  can be swapped at runtime:
  
  • BCrypt (current)
  • Argon2 (memory-hard)
  • SCrypt (CPU/memory intensive)
  • Pbkdf2
  
  Change algorithm without
  affecting authentication code.
end note

note bottom of Course
  **OBSERVER PATTERN**
  ━━━━━━━━━━━━━━━━━━━
  @CreationTimestamp annotation
  observes entity lifecycle:
  
  • JPA EntityManager is Subject
  • Annotation is Observer
  • Persist event triggers notification
  • Timestamp auto-populated
  
  Eliminates manual timestamp code.
end note

note bottom of CyberEdPlatformApplication
  **FACTORY METHOD PATTERN**
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  @Bean methods are factories:
  
  • createAdmin() - Creates admin with
    roles and encoded password
  • seedCourses() - Creates initial
    course catalog (3 courses)
  • createDemoUser() - Creates demo
    user for testing
  
  Encapsulates complex object
  creation and initialization.
  Runs automatically at startup.
end note

note left of CustomUserDetailsService
  **TEMPLATE METHOD PATTERN**
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Spring Security authentication
  algorithm (template):
  
  1. Extract username from request
  2. **Call loadUserByUsername()** ← We customize
  3. Compare passwords
  4. Check authorities/roles
  5. Create authentication token
  6. Store in security context
  
  We only implement step 2.
  Framework handles rest securely.
end note

note bottom of HomeController
  **SINGLETON PATTERN**
  ━━━━━━━━━━━━━━━━━━━━
  Spring IoC Container manages
  all @Controller, @Service, and
  @Configuration beans as singletons:
  
  • One instance per application
  • Thread-safe concurrent access
  • Efficient resource usage
  • Automatic dependency injection
  
  Exception: CartService is
  @SessionScope (one per user session)
end note

' ============================================
' ADDITIONAL ANNOTATIONS
' ============================================
note top of Purchase
  Uses @CreationTimestamp
  Same Observer pattern as Course
end note

@enduml